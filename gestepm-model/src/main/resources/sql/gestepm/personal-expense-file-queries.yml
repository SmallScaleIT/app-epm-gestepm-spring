sql:

  qry-list-of-pef: |
    
    SELECT
      pef.personal_expense_file_id AS id_pagination,
      pef.personal_expense_file_id,
      pef.personal_expense_id,
      pef.name,
      pef.storage_path,
      pef.content
    FROM ${sch-gestepm}.personal_expense_file pef
    
    #whereToken #filter

  qry-page-of-pef: |

    ${sql.qry-list-of-pef}
    ${sql.paginated-query}
    
  qry-count-of-pef: |

    SELECT COUNT(DISTINCT personal_expense_file_id) AS "count"
    FROM (
      SELECT pef.personal_expense_file_id
      FROM ${sch-gestepm}.personal_expense_file pef     
      #whereToken #filter
    ) final
    
  qry-create-pef: |
    
    INSERT INTO ${sch-gestepm}.personal_expense_file (
      personal_expense_id,
      name,
      storage_path,
      content
    )
    VALUES (
      :attr_pef_pe_id,
      :attr_pef_name,
      :attr_pef_storage_path,
      :attr_pef_content
    )

  qry-update-pef: |
    
    UPDATE
      ${sch-gestepm}.personal_expense_file
    SET
      name = :attr_pef_name,
      storage_path = :attr_pef_storage_path
    WHERE
      personal_expense_file_id = :attr_pef_id

  qry-delete-pef: |
    
    DELETE FROM ${sch-gestepm}.personal_expense_file WHERE personal_expense_file_id = :attr_pef_id
    
  filter-pef-by-params: |

    -- [AND
      -- ${sql.predicate-for-pef-ids}
      -- ${sql.predicate-for-pef-pe-id}
      -- ${sql.predicate-for-pef-need-migration}
    -- AND]

  filter-pef-by-id: |

    -- [AND
      -- ${sql.predicate-for-pef-id}
    -- AND]

  predicate-for-pef-id: |

    pef.personal_expense_file_id = :attr_pef_id

  predicate-for-pef-ids: |

    pef.personal_expense_file_id IN (:attr_pef_ids)

  predicate-for-pef-pe-id: |

    pef.personal_expense_id = :attr_pef_pe_id

  predicate-for-pef-need-migration: |
    
    :attr_pef_need_migration = 1 AND pef.storage_path IS NULL
